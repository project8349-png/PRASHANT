name: Download APK

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths:
      - 'mobile/**'

jobs:
  prepare-apk:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install mobile dependencies
      run: |
        cd mobile
        npm install
        
    - name: Create build directory
      run: mkdir -p mobile/dist
      
    - name: Create APK placeholder
      run: |
        echo "PRASHANT Mobile App v1.0" > mobile/dist/README.txt
        echo "" >> mobile/dist/README.txt
        echo "To build real APK:" >> mobile/dist/README.txt
        echo "1. Use Expo Go: npx expo start" >> mobile/dist/README.txt
        echo "2. Use EAS: eas build --platform android" >> mobile/dist/README.txt
        echo "3. Manual: npm run build:apk" >> mobile/dist/README.txt
        
    - name: Create APK Info File
      run: |
        cat > mobile/dist/APK-INFO.md << 'EOF'
        # PRASHANT APK Build Guide
        
        ## Quick APK Build Methods
        
        ### Method 1: Using Expo Go (Instant - No APK)
        ```bash
        cd mobile
        npx expo start
        ```
        Scan QR code with Expo Go app
        
        ### Method 2: Using Web (Instant)
        ```bash
        cd mobile
        npm install -g expo-cli
        npx expo start --web
        ```
        
        ### Method 3: Real APK with EAS (5-10 mins)
        ```bash
        npm install -g eas-cli
        eas login
        eas build --platform android
        ```
        
        Download signed APK from EAS dashboard
        
        ### Method 4: Manual Local Build
        ```bash
        cd mobile
        npx expo prebuild --clean
        cd android
        ./gradlew assembleRelease
        ```
        
        APK will be at: `mobile/android/app/build/outputs/apk/release/app-release.apk`
        EOF
        
    - name: Upload Build Info
      uses: actions/upload-artifact@v3
      with:
        name: PRASHANT-BUILD-INFO
        path: |
          mobile/dist/
        retention-days: 30
        
    - name: Upload Build Guide
      uses: actions/upload-artifact@v3
      with:
        name: APK-BUILD-METHODS
        path: mobile/dist/APK-INFO.md
