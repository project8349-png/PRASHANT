name: Build APK with Gradle

on:
  push:
    branches: [ main, master ]
    paths:
      - 'mobile/**'
      - '.github/workflows/apk-build.yml'

jobs:
  build-apk:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Setup Java
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '11'

    - name: Install dependencies
      run: |
        cd mobile
        npm install
        npx expo-cli --version

    - name: Create APK locally using Expo
      run: |
        cd mobile
        npx expo prebuild --clean || echo "Prebuild optional"
        # APK build command will be available with paid Expo account
        echo "APK build requires EAS account setup"

    - name: Build APK Setup Instructions
      run: |
        echo "==== PRASHANT Mobile App Build ===="
        echo ""
        echo "To build APK, use one of these methods:"
        echo ""
        echo "Method 1: Using Expo Go (Free - for testing)"
        echo "  cd mobile"
        echo "  npx expo start"
        echo "  Scan QR code with Expo Go app"
        echo ""
        echo "Method 2: Using EAS (Free account)"
        echo "  eas login"
        echo "  eas build --platform android"
        echo ""
        echo "Method 3: Manual APK generation"
        echo "  cd mobile"
        echo "  npx expo prebuild --clean"
        echo "  cd android"
        echo "  ./gradlew assembleRelease"
